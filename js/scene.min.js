(function(e){var c,m={},k=[],b=[],f;var i={top:"px",bottom:"px",left:"px",right:"px"};function h(p,o){return{x:p,y:o}}function j(o){if(m.hasOwnProperty(o)){return o}else{if(m.hasOwnProperty(o.name)){return o.name}else{if(m.hasOwnProperty(o.selector)){return o.selector}}}}var g=e.scene=function(){var o=arguments[0],p=arguments[1];if(!o){return undefined}if(p){return m[o]=new d(o,g.select(o),p)}else{return m[j(o)]}};var l=g.events=new n();var a=g.parseTime=function(o){if(typeof o=="number"){return o}if(/ms$/i.test(o)){return parseFloat(o)/1000}return parseFloat(o)};g.select=function(o){if(typeof o!="string"){return o}return document.getElementById(o)||document.querySelectorAll(o)[0]};g.remove=function(p){p=j(p);if(p){var q=m[p].node,o=q.parentNode;if(o){o.removeChild(q)}m[p].events.clear();delete m[p]}return this};g.schedule=function(o,p){if(typeof p==="function"){switch(o){case"before":k.push(p);break;case"after":b.push(p);break}}return this};g.start=function(q){if(c==undefined){var o=a(q),p=o*1000;c=setInterval(function(){for(var s in k){if(typeof k[s]=="function"){k[s].call(null,o,m)}}for(var r in m){if(m.hasOwnProperty(r)){var t=m[r];if(t.enabled){t.position(o,"next")}}}for(var s in b){if(typeof b[s]=="function"){b[s].call(null,o,m)}}},p);return true}return false};g.stop=function(){if(c!=undefined){c=clearInterval(c)}};function n(){this.callbacks={}}n.prototype.emit=function(s){var p=this.callbacks[s],q=Array.prototype.slice.call(arguments,1),o;if(p){o=p.length;for(var r=0;r<o;r++){p[r].apply(null,q)}}};n.prototype.on=function(q,r){var p=q.split(/\s+/);for(var o=0;o<p.length;o++){(this.callbacks[p[o]]=this.callbacks[p[o]]||[]).push(r)}return this};n.prototype.clear=function(){this.callbacks={};return this};function d(p,r,q){this.node=r;this.enabled=true;this.events=new n();this._motions=[];this.map=q.map||h;this.addMotion("velocity",function(w,v,x){return{x:this.dx*w,y:this.dy*w}});this.dx=q.dx||0;this.dy=q.dy||0;this.name=q.name||p;var t=parseFloat(this.current("left")),s=parseFloat(this.current("top")),o=(q.x==undefined)?t:q.x,u=(q.y==undefined)?s:q.y;this.style("left",o).style("top",u)}d.prototype.current=function(o){return this.node.style[o]};d.prototype.style=function(r,q){if(arguments.length==1){var o=this.node.style[r],p=window.getComputedStyle;if(o.length==0||/auto/i.test(o)){return p(this.node)[r]}else{return o}}else{if(i.hasOwnProperty(r)){q=q+i[r]}this.node.style.setProperty(r,q,"");return this}};d.prototype.setVendorStyle=function(p,o){return this.style("-webkit-"+p,o).style("-moz-"+p,o).style("-ms-"+p,o).style("-o-"+p,o)};d.prototype.addMotion=function(p,o){if(typeof o=="function"){this._motions[p]=o}return this};d.prototype.removeMotion=function(o){delete this._motions[o];return this};d.prototype.position=function(){var w=parseFloat(arguments[1])||0,u=parseFloat(arguments[2])||0,q=a(arguments[0]),o=parseFloat(this.current("left")),v=parseFloat(this.current("top"));if(arguments.length==0){return{x:o,y:v}}if(arguments[1]=="next"){for(var p in this._motions){if(this._motions.hasOwnProperty(p)){var r=this._motions[p].call(this,q,o,v);if(r){w+=r.x;u+=r.y}}}}var t=this.map.call(this,o+w,v+u);return this.style("left",t.x).style("top",t.y)};d.prototype.width=function(){return parseFloat(this.style("width"))};d.prototype.height=function(){return parseFloat(this.style("height"))};d.prototype.vel=function(){if(arguments.length==0){return{x:this.dx,y:this.dy}}else{var p=parseFloat(arguments[0])||0,o=parseFloat(arguments[1])||0;this.dx=p;this.dy=o;return this}};g.SceneObj=d;g.EventEmitter=n})(this);
